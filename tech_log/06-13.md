# 20200613

## 오늘 구현한 내용

- 댓글 수정 및 삭제 버튼 완성, 수정 버튼의 경우 해당 유저가 아니면 안 눌리도록 설정
- 데이터 수집
- 좋아요 버튼

### 데이터 저장 & 로드

#### ❗️어려웠던 점

- 데이터 저장은 Django REST 서버로 요청을 보내면 그 곳에서 다른 API 에 요청을 보내 데이터를 DB에 직접 저장하는 방식으로 구현했습니다. DB 설정이 덮여쓰일 수 있으므로 다른 서버를 이용해서 DB에 데이터를 저장 후 dumpdata를 사용하여 json파일을 생성하였습니다.

```python 
 python manage.py loaddata movies/fixtures/movies/moviedata.json
```

- loaddata를 할 때  위의 방식으로 명령어를 사용해야했는데 이유를 알 수 없었다.

#### :star:배운 점

- 무비 데이터를 받아올 시  genre 데이터가 선행되지 않으면 에러가 발생하므로 영화 데이터를 받아올 때 genre objects가 있는지를 검사, 없을 경우 genre objects를 불어오도록 수정했습니다. 

- 이미 DB에 있는 데이터는 적용하지 않도록 설정했습니다.

   

### 좋아요 버튼

#### ❗️어려웠던 점

![image-20200613093528067](.\images\image-20200613093528067.png)

- 좋아요 버튼을 눌렀을 때 정상적으로 좋아요가 동작하지 않았습니다.
- 페이지가 로드되었을 때 유저가 이미 좋아요를 했으면 좋아요를 표시해줘야했습니다.

#### ⭐️배운 점

- 기존의 브라우저에 로그인할 때 저장된 auth-token이 유효하지 않았기 때문이었습니다. 다른 사람의 repo에서 데이터를 pull했기 때문에 DB파일이 존재하지 않아 auth-token이 DB에 등록되어있지 않았습니다.

- 페이지가 로드되었을 때 유저의 좋아요 상태를 알기 위하여 유저가 로그인을 할 경우 쿠키에 유저의 정보를 저장했습니다. 일단 실험을 위하여 `userId` 값을 이용하여 유저를 구분해서 좋아요의 상태를 보여줬습니다. 다만 이럴 경우 유저가 임의로 쿠키의 `userId`값을 바꿔버리면 제기능을 못하게 됩니다. 또, 유저의 정보이므로 나중에 username을 이용하여 해시하는 등의 방법을 사용하겠습니다.



### 영화 ID

- themovieDB가 데이터를 수집하기 좋아서 themovieDB API를 사용하기로 변경했습니다.
- 사이트에서 보여질 영화 ID를 DB에 생성되는 순으로 할지 themovieDB에 저장된 id를 사용할 지 고민하다가 themovieDB에 있는 영화를 검색하기 편하게 themovieDB id를 사용하기로 결정했습니다.



### api_view

#### ❗️어려웠던 점

- Response를 사용했는데 에러가 발생했습니다.



#### ⭐️배운 점

- `@api_view` 데코레이터를 사용하지 않으면 Response를 사용할 수 없었습니다.



### URL 설정

#### ❗️어려웠던 점

- URL을 기준 없이 정할 경우 오류가 발생할 수 있습니다.
- 예) `movies/2` 의 경우 2는 movie의 ID인데, `movies/recommend`같은 url을 만들게 될 경우 아이디를 recommend로 인식해 없는 ID로 처리되어 에러가 발생합니다.

####  ⭐️배운 점

- URL 설정시 movies/2 의 규칙으로 설정해서 문제를 차단해야합니다.



### 내일 해야 될 일

- DB 2500개 생성 후 실제 로컬 서버에 적용
- 게시글 수정 만들기
- 댓글 수정 만들기
- 댓글 삭제 만들기
- 영화 장르 Badge 완성
- Recommendation을 위한 영화 고르기 페이지 마무리
- 이미 좋아요 한 영화 보여주지 않기
- 영화 평점 추가

- 감독, 배우 추가

### :thought_balloon:느낀 점

- 데이터에서 정적 데이터와 동적데이터로 나누고 동적데이터가 변할 때마다 다른 것에 영향을 주는 것을 생각하여야 합니다.